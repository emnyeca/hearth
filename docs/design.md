# EUB-PSU “Hearth” Rev0 — Design & Project Document

## 0. このドキュメントの目的（Copilot向け）
本ドキュメントは EUB-PSU “Hearth” Rev0 の設計意図と制約条件を定義する。
KiCad設計時に **迷わない判断軸** を与えることを目的とする。

- ファームウェアは存在しない（Rev0ではMCU非搭載）。

---

## 1. プロジェクト概要
### 1.1 名前
- EUB-PSU “Hearth”
- 呼称：Hearth

### 1.2 役割
- EUBシリーズ共通の電源コア（Power Core）
- Emiuet / ガムシンセ / コードメーカー 等へ電源を供給
- 電源単体で動作確認・切り分けが可能

### 1.3 設計思想
- 家庭内使用前提（剛性より かわいさ・安心感）
- オシロスコープ不要：**DMMのみで状態確認できる**
- 電源は「見える・触れる・切り分けられる」ことが最重要

---

## 2. 物理仕様（重要）
### 2.1 上面パネル寸法（最優先制約）
- 102.5 mm × 24.0 mm
- Emiuet 左パネルと同寸
- 上面パネルはPCB（白ソルダーマスク + ENIG）

### 2.2 ネジ穴
- Emiuet 左パネルと同じ位置にネジ穴を配置
- 目的：将来、自由に接合・ドッキングできるようにする
- Rev0では固定方法は決めない
- ネジ径：M2（Emiuet側仕様に準拠）

### 2.3 厚み目標
- 総厚み：15〜18 mm（目標 約16 mm）
- 上パネルPCB：1.6 mm
- 内部空間：12〜13 mm
- 下パネルPCB：1.6 mm

### 2.4 コネクタ配置
- すべて長辺側（102.5mm側）
- 短辺側（24mm側）にはコネクタを置かない
- 理由：Emiuetに載せた状態でケーブルを横に逃がすため

---

## 3. 筐体構成
### 3.1 構造
PCBサンド構造：
- [ 上パネル PCB (102.5×24) ]
- [ Hearth PSU 基板 ]
- [ 下パネル PCB ]

側面は以下のいずれか（Rev0では決定しない）
- オープン
- PETG製サイドバンド（後付け可能）

### 3.2 材質方針
- 上下パネル：FR-4 PCB
- ソルダーマスク：白
- 表面処理：ENIG

理由：
- 剛性が高く割れにくい
- デザイン自由度が高い
- EUBらしい「基板＝構造材」

---

## 4. 電源仕様
### 4.1 入力
- USB-C（5V, Sink固定）
- LiPoバッテリー（1セル）
  - JST-PH 2pin

追加（オプション入力）：
- DC 9V（センターマイナス）
  - 目的：USBが使えない場面での「給電のみ」
  - 充電はUSB経由のBQのみ（DC9Vからは充電しない）

### 4.2 PowerPath
- USB or バッテリーの自動切替
- USB接続時は給電＋充電同時可能

### 4.3 出力レール
- SYS：PowerPath後の生電源
- +3V3：LDO生成
- +5V：昇圧生成（MIDI等用）

---

## 5. 外部コネクタ
### 5.1 EUB-BUS OUT（唯一の外部出力）
- JST XH 2.54mm / 6pin
- 基板側：縦（Vertical header）
- ケーブル側：XHハーネス

ピン定義（確定）

| Pin | Signal |
|---:|---|
| 1 | GND |
| 2 | SYS |
| 3 | +5V |
| 4 | +3V3 |
| 5 | USB_PGOOD_OD |
| 6 | CHG_STAT_OD |

注記：
- SYS は「システム電源レール」を意味する（USB/BAT または DC9V から供給される主電源）
- +5V / +3V3 は常に SYS から生成される
- USB_PGOOD_OD と CHG_STAT_OD は **オープンドレイン出力**
  - Hearth 側はデフォルトでプルアップしない（プルアップ抵抗はフットプリントのみで DNP）

---

## 6. 可視化・測定設計（最重要）
### 6.1 テストパッド（必須）
- VBUS
- BAT
- SYS
- +3V3
- +5V
- GND（複数）

ルール：
- すべてシルクで明示

### 6.2 LED表示（MCUなし）
- VBUS present
- SYS alive
- 3V3 alive
- 5V alive
- PG
- CHG

ルール：
- MCU経由は禁止
- 電源・信号に直結（抵抗経由）

---

## 7. 切り分け用ギミック
### 7.1 ジャンパ / スイッチ
- 5V Boost Enable / Disable
- NTC 実体 / 抵抗置換 切替

### 7.2 ダミー負荷
- +3V3 用（段階式）
- +5V 用（段階式）

目的：
- 無負荷OK / 負荷でNG をテスターで判断する

---

## 8. 非搭載・非対応（明示）
- MCU：搭載しない
- ファームウェア：存在しない
- USB Host / OTG：Rev0では非対応
- 複数EUB同時給電：Rev0では想定しない

---

## 9. リポジトリ構成（GitHub）

```
hearth/
├─ README.md
├─ docs/
│  ├─ design.md
│  ├─ power_notes.md
│  ├─ mech_notes.md
│  └─ operations.md
├─ kicad/
│  ├─ Hearth.kicad_pro
│  ├─ Hearth.kicad_sch
│  ├─ Hearth.kicad_pcb
│  └─ symbols_footprints/
└─ fab/
   ├─ gerber/
   └─ bom/
```

KiCad 9.x 前提。

---

## 10. 未確定事項（Rev0で先に決めると迷わない）
以下は“仕様の骨格”に影響するので、早めに確定推奨。

- 目標出力電流（SYS / +3V3 / +5V の最大）
- +5Vが「常時ON」か「必要時のみON」か（Boost Enableのデフォルト状態）
- EUB-BUSの電源逆流（他機器からHearthへ逆流）を許容するか／禁止するか
- PG/CHGの論理（High/Low、オープンドレイン想定、プルアップ先）

---

## 11. 入力ポリシー（追加仕様：USB vs DC9V）

### 11.1 USB-C IN
- 機能：システム給電 + バッテリー充電
- ユーザー表示ラベル："USB-C IN (Power / Charge)"

### 11.2 DC 9V IN（センターマイナス）
- 機能：システム給電のみ（充電しない）
- ユーザー表示ラベル："DC 9V IN (Power Only)"

電気ポリシー：
- DC9V は BQ 充電ICの入力へ接続しない
- DC9V は降圧して SYS 相当レール（SYS）を生成する

### 11.3 パワーパス / 切替
- DC9V 系と USB/BAT（BQのシステム出力）系は SYS に対して **相互排他**
- DC9V が存在する場合：
  - SYS は DC9V（降圧後）で供給
  - BQ のシステム出力は SYS から電気的に切り離す（FET/理想ダイオード等で遮断）
  - USB は同時にバッテリー充電のみ実行してよい

実装方針：
- ジャックの検出接点は「制御信号」にのみ使用する
- システム電流を機械接点経由で流さない（実電流の遮断/合流はFET系で行う）

### 11.4 バッテリー分離ポリシー
- バッテリーは BQ のみに接続する
- バッテリーが SYS や EUB-BUS に直接つながる経路を作らない
- BQ_OUT を切り離した場合、バッテリーはシステム電源から完全に分離されること
